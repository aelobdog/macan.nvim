# Contributing to Macan

Thank you for your interest in contributing to Macan!
This document provides guidelines and information for developers who want to contribute to the project.

```
Disclaimer: This file was generated by AI.
I'm not really that strict when it comes to these guidelines.
So if you have something you can contribute, shoot a PR my way.
I'll take a look at it, and if it feels like a good addition, let's incorporate it.
Cheers!
```

## Quick Start for Developers

### Prerequisites
- Neovim 0.7+ with Lua support
- LLVM tools (`llvm-mca`, `clang`/`clang++`)
- Git
- A C project with `compile_commands.json` for testing

### Development Setup

1. **Clone the repository**:
   ```bash
   git clone https://github.com/your-username/macan-tui.git
   cd macan-tui
   ```

2. **Install for development**:
   ```bash
   # Create a symlink in your Neovim config
   ln -s $(pwd) ~/.local/share/nvim/site/pack/dev/start/macan-tui
   ```

3. **Restart Neovim** and test:
   ```vim
   :lua require('macan').setup()
   :MacanHelp
   ```

## Project Structure

```
macan-tui/
├── lua/macan/
│   ├── init.lua                # Main plugin entry point and commands
│   ├── config.lua              # Configuration management
│   ├── llvm_mca.lua            # LLVM-MCA integration and parsing
│   ├── dependency_analysis.lua # Instruction dependency analysis
│   ├── live_update.lua         # Live update functionality
│   ├── output.lua              # Output display and formatting
│   ├── markers.lua             # Start/end marker management
│   ├── compile_commands.lua    # compile_commands.json parsing
│   ├── compile_flags_ui.lua    # Custom compile flags UI
│   └── asmgen.lua              # Assembly generation
├── plugin/
│   └── macan.vim               # Vim plugin registration
├── README.md                   # User documentation
├── CHANGELOG.md                # Version history
├── CONTRIBUTING.md             # This file
└── LICENSE                     # MIT license
```

## Architecture Overview

### Core Components

1. **init.lua** - Plugin initialization and command definitions
2. **llvm_mca.lua** - LLVM-MCA tool integration and output parsing
3. **dependency_analysis.lua** - Instruction dependency detection engine
4. **output.lua** - Display formatting and window management
5. **live_update.lua** - Automatic analysis triggers and debouncing

### Data Flow

```
C Source File → Markers → Assembly Generation → LLVM-MCA → Parsing → Dependency Analysis → Display
     ↑                                                                                        ↓
   Live Updates ←───────────────────────────────────────────────────────────────────── User Interaction
```

## Development Guidelines

### Code Style

- **Lua Style**: Follow standard Lua conventions
- **Indentation**: 2 spaces, no tabs
- **Line Length**: Prefer 100 characters or less
- **Comments**: Document complex logic and public functions
- **Error Handling**: Always handle errors gracefully with user-friendly messages

### Function Documentation
```lua
-- Brief description of what the function does
-- @param param_name type Description of parameter
-- @return return_type Description of return value
function M.example_function(param_name)
  -- Implementation
end
```

### Error Handling Pattern
```lua
local success, result = pcall(function()
  -- Potentially failing operation
  return some_operation()
end)

if not success then
  vim.notify('Error: ' .. (result or 'Unknown error'), vim.log.levels.ERROR)
  return nil
end

return result
```

## Testing

### Manual Testing Workflow

1. **Create a test C file**:
   ```c
   void test_function() {
       int a = 5;
       int b = 10;
       int c = a + b;
       return c * 2;
   }
   ```

2. **Test the full workflow**:
   - Set markers with `:MacanSetStart` and `:MacanSetEnd`
   - Run analysis with `:MacanRunMCA`
   - Verify live updates work on save
   - Test dependency highlighting

3. **Test error conditions**:
   - Missing `compile_commands.json`
   - Invalid markers
   - Compilation errors
   - Missing LLVM tools

### Adding New Features

When adding new features, consider:

1. **User Experience**: How will users discover and use this feature?
2. **Error Handling**: What can go wrong and how should we handle it?
3. **Performance**: Will this impact live update performance?
4. **Configuration**: Should this be configurable?
5. **Documentation**: Update README.md and help text

## Debugging

### Debug Output
Enable debug output by checking:
- `:messages` for Neovim messages
- `vim.g.macan_last_raw_output` for raw LLVM-MCA output
- `:MacanShowRawOutput` for formatted raw output

### Common Issues

**Dependency Analysis Not Working**:
- Check `dependency_analysis.lua` parsing logic
- Verify assembly syntax detection
- Test with `:MacanConfig status`

**Live Updates Not Triggering**:
- Check `live_update.lua` autocommand setup
- Verify debouncing logic
- Test file save events

**Output Display Issues**:
- Check `output.lua` window management
- Verify buffer creation and highlighting
- Test window closing/reopening

## Submitting Changes

### Pull Request Process

1. **Fork the repository** and create a feature branch
2. **Make your changes** following the guidelines above
3. **Test thoroughly** with different scenarios
4. **Update documentation** if needed
5. **Submit a pull request** with a clear description

### Commit Message Format
```
type: brief description

Longer description if needed explaining:
- What changed
- Why it changed
- Any breaking changes
```

Types: `feat`, `fix`, `docs`, `refactor`, `test`, `chore`

### Examples
```
feat: add Intel syntax support for dependency analysis

- Implement Intel assembly syntax detection
- Add operand parsing for Intel format
- Update register aliasing to handle both syntaxes
- Add configuration option for syntax preference

fix: handle missing compile_commands.json gracefully

- Show helpful error message when file is missing
- Provide guidance on generating compile_commands.json
- Prevent crashes when file is malformed
```

## Areas for Contribution

### High Priority
- **More CPU architectures**: ARM, RISC-V support
- **Assembly syntax**: Intel syntax improvements
- **Performance**: Optimize dependency analysis for large functions
- **Error handling**: Better error messages and recovery

### Medium Priority
- **Testing**: Automated test suite
- **UI improvements**: Better visual feedback
- **Documentation**: Video tutorials, more examples
- **Integration**: Support for more build systems

### Low Priority
- **Language support**: C++ templates, inline assembly
- **Export features**: Save analysis results
- **Themes**: Customizable highlighting colors
- **Plugins**: Integration with other Neovim plugins

## Feature Ideas

We welcome ideas for new features! Before implementing:

1. **Open an issue** to discuss the feature
2. **Consider the use case**: Who will benefit?
3. **Think about complexity**: Is it worth the maintenance burden?
4. **Check feasibility**: Can it be implemented reliably?

## Getting Help

- **GitHub Issues**: For bugs and feature requests
- **Discussions**: For questions and general discussion
- **Code Review**: We're happy to review code and provide feedback

## Recognition

Contributors will be recognized in:
- README.md acknowledgments
- CHANGELOG.md for significant contributions
- GitHub contributors page

Thank you for contributing to Macan! Your help makes this project better for everyone. 